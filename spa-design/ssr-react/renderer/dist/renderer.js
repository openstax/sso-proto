!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=12)}([function(e,t){e.exports=require("path")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("@babel/runtime/regenerator")},function(e,t){e.exports=require("node-fetch")},function(e,t){e.exports=require("lodash/fp")},function(e,t){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,t,n){"use strict";n.r(t),n.d(t,"archiveLoader",function(){return c});var r=n(3),o=n.n(r),c=function(e){return o()("https://archive.cnx.org/contents/"+e)}},function(e,t){e.exports=require("react")},function(e,t){e.exports=require("styled-components")},function(e,t){e.exports=require("@babel/runtime/helpers/slicedToArray")},function(e,t){e.exports=require("react-dom/server")},function(e,t){e.exports=require("app")},function(e,t,n){"use strict";n.r(t);var r=n(2),o=n.n(r),c=n(5),a=n.n(c),i=n(0),s=n.n(i),u=n(1),l=n.n(u),f=n(3),p=n(4),d=p.get,v=p.flatten,h=n(6).archiveLoader,m=n(13).unicornLoader,x=function e(t){return v(t.map(function(t){return v(t.contents?e(t.contents):[t])}))};var y=s.a.resolve(process.cwd(),process.env.ASSET_DIR||"build"),b=m(y);function g(){return(g=a()(o.a.mark(function e(){var t,n,r,c,a,i,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b("/",{processAuthentication:!1});case 2:return e.next=4,f("http://nginx/api/v2/pages/?type=books.Book&limit=250&fields=cover_url,description,title,cnx_id").then(function(e){return e.json()}).then(d("items"));case 4:t=e.sent,n=!0,r=!1,c=void 0,e.prev=8,a=t[Symbol.iterator]();case 10:if(n=(i=a.next()).done){e.next=18;break}return s=i.value,console.log("Discovered book:",s.title),e.next=15,h(s.cnx_id).then(function(e){return e.json()}).then(j);case 15:n=!0,e.next=10;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(8),r=!0,c=e.t0;case 24:e.prev=24,e.prev=25,n||null==a.return||a.return();case 27:if(e.prev=27,!r){e.next=30;break}throw c;case 30:return e.finish(27);case 31:return e.finish(24);case 32:case"end":return e.stop()}},e,this,[[8,20,24,32],[25,,27,31]])}))).apply(this,arguments)}!function(){g.apply(this,arguments)}();var S=function(e){return function(){var t=a()(o.a.mark(function t(n){var r,c,a,i;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r="".concat(n.shortId,"@").concat(n.version),c="".concat(e,"/").concat(r),t.next=4,b(c);case 4:a=t.sent,i=a.html,200===a.status&&(w("".concat(c,".html"),i),w("".concat(c,".json"),JSON.stringify(n)));case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()};function j(e){return k.apply(this,arguments)}function k(){return(k=a()(o.a.mark(function e(t){var n,r,c,a,i,s,u,l;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n="".concat(t.shortId,"@").concat(t.version),r="/book-content/".concat(n),w("".concat(r,".json"),JSON.stringify(t)),c=!0,a=!1,i=void 0,e.prev=6,s=x(t.tree.contents)[Symbol.iterator]();case 8:if(c=(u=s.next()).done){e.next=15;break}return l=u.value,e.next=12,h(l.shortId).then(function(e){return e.json()}).then(S(r));case 12:c=!0,e.next=8;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(6),a=!0,i=e.t0;case 21:e.prev=21,e.prev=22,c||null==s.return||s.return();case 24:if(e.prev=24,!a){e.next=27;break}throw i;case 27:return e.finish(24);case 28:return e.finish(21);case 29:case"end":return e.stop()}},e,this,[[6,17,21,29],[22,,24,28]])}))).apply(this,arguments)}function w(e,t){var n=s.a.join(y,e);!function e(t){var n=s.a.dirname(t);if(l.a.existsSync(n))return!0;e(n),l.a.mkdirSync(n)}(n),l.a.writeFile(n,t,function(e){return e&&console.log(e)})}},function(e,t,n){"use strict";n.r(t),n.d(t,"unicornLoader",function(){return b});var r=n(9),o=n.n(r),c=n(0),a=n.n(c),i=n(1),s=n.n(i),u=n(7),l=n.n(u),f=n(4),p=n(10),d=n(8),v=n(3),h=n.n(v),m=n(6),x=n(11),y=n.n(x),b=function(e){console.log("assets from",e);var t=JSON.parse(s.a.readFileSync(a.a.resolve(e,"asset-manifest.json"))),n=s.a.readFileSync(a.a.resolve(e,"index.html"),"utf8");return function(e){console.log("starting run for: ".concat(e));var r=[],c=y()({services:{processAuthentication:!1,fetch:h.a,loadArchive:m.archiveLoader},initialHistory:[e],enableDevtools:!1,loadableReporter:function(e){return r.push(e)}}),a=c.Container,i=c.store;c.history;return c.effectRunner.down().then(function(){var c=i.getState(),s=c.Navigation.location.pathname;return s!=e?{status:301,location:s,state:c}:function(e){var t=e.modules,n=e.manifest,r=e.indexHtml,c=e.Container,a=e.state,i="Unicorn.NotFound"===a.Navigation.match.name,s=a.Unicorn.notAllowed,u=new d.ServerStyleSheet,v=Object(p.renderToString)(l.a.createElement(d.StyleSheetManager,{sheet:u.instance},l.a.createElement(c,null))),h=u.getStyleTags(),m=function(e,t){return Object(f.keys)(e).filter(function(e){return t.indexOf(e.replace(".js",""))>-1}).map(function(t){return e[t]})}(n,t).map(function(e){return'<script type="text/javascript" src="/'.concat(e,'"><\/script>')}),x=function(e,t){t.html;var n=t.title,r=t.meta,o=t.body,c=t.scripts,a=t.styles,i=t.state;return e=(e=(e=(e=e.replace(/<title>.*?<\/title>/g,n)).replace("</head>","".concat(r).concat(a,"</head>"))).replace('<div id="root"></div>','<div id="root">'.concat(o,"</div><script>window.__PRELOADED_STATE__ = ").concat(i,"<\/script>"))).replace("</body>",c.join("")+"</body>")}(r,{title:"<title>".concat(a.Unicorn.title,"</title>"),meta:a.Unicorn.meta.map(function(e){return"<meta ".concat(Object(f.toPairs)(e).map(function(e){var t=o()(e,2),n=t[0],r=t[1];return"".concat(n,'="').concat(r,'"')}).join(" ")," />")}).join(""),body:v,state:JSON.stringify(a).replace(/</g,"\\u003c"),scripts:m,styles:h});return{status:i?404:s?401:200,state:a,html:x}}({modules:r,indexHtml:n,manifest:t,Container:a,state:c})})}}}]);